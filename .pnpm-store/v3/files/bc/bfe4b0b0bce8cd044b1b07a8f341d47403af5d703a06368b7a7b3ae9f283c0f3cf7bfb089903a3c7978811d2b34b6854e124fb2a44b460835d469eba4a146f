"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const operators_1 = require("rxjs/operators");
const reportBigTarballsProgress_1 = __importDefault(require("./reportBigTarballsProgress"));
const reportContext_1 = __importDefault(require("./reportContext"));
const reportDeprecations_1 = __importDefault(require("./reportDeprecations"));
const reportHooks_1 = __importDefault(require("./reportHooks"));
const reportInstallChecks_1 = __importDefault(require("./reportInstallChecks"));
const reportLifecycleScripts_1 = __importDefault(require("./reportLifecycleScripts"));
const reportMisc_1 = __importDefault(require("./reportMisc"));
const reportPeerDependencyIssues_1 = __importDefault(require("./reportPeerDependencyIssues"));
const reportProgress_1 = __importDefault(require("./reportProgress"));
const reportRequestRetry_1 = __importDefault(require("./reportRequestRetry"));
const reportScope_1 = __importDefault(require("./reportScope"));
const reportSkippedOptionalDependencies_1 = __importDefault(require("./reportSkippedOptionalDependencies"));
const reportStats_1 = __importDefault(require("./reportStats"));
const reportSummary_1 = __importDefault(require("./reportSummary"));
const reportUpdateCheck_1 = __importDefault(require("./reportUpdateCheck"));
function default_1(log$, opts) {
    const width = opts.width ?? process.stdout.columns ?? 80;
    const cwd = opts.pnpmConfig?.dir ?? process.cwd();
    const throttle = typeof opts.throttleProgress === 'number' && opts.throttleProgress > 0
        ? (0, operators_1.throttleTime)(opts.throttleProgress, undefined, { leading: true, trailing: true })
        : undefined;
    const outputs = [
        (0, reportProgress_1.default)(log$, {
            cwd,
            throttle,
        }),
        (0, reportPeerDependencyIssues_1.default)(log$),
        (0, reportLifecycleScripts_1.default)(log$, {
            appendOnly: opts.appendOnly === true || opts.streamLifecycleOutput,
            aggregateOutput: opts.aggregateOutput,
            cwd,
            width,
        }),
        (0, reportDeprecations_1.default)(log$.deprecation, { cwd, isRecursive: opts.isRecursive }),
        (0, reportMisc_1.default)(log$, {
            appendOnly: opts.appendOnly === true,
            config: opts.config,
            cwd,
            logLevel: opts.logLevel,
            zoomOutCurrent: opts.isRecursive,
        }),
        ...(0, reportStats_1.default)(log$, {
            cmd: opts.cmd,
            cwd,
            isRecursive: opts.isRecursive,
            width,
        }),
        (0, reportInstallChecks_1.default)(log$.installCheck, { cwd }),
        (0, reportRequestRetry_1.default)(log$.requestRetry),
        (0, reportScope_1.default)(log$.scope, { isRecursive: opts.isRecursive, cmd: opts.cmd }),
        (0, reportSkippedOptionalDependencies_1.default)(log$.skippedOptionalDependency, { cwd }),
        (0, reportHooks_1.default)(log$.hook, { cwd, isRecursive: opts.isRecursive }),
        (0, reportContext_1.default)(log$, { cwd }),
        (0, reportUpdateCheck_1.default)(log$.updateCheck),
    ];
    if (!opts.appendOnly) {
        outputs.push((0, reportBigTarballsProgress_1.default)(log$));
    }
    if (!opts.isRecursive) {
        outputs.push((0, reportSummary_1.default)(log$, {
            cwd,
            env: opts.env,
            pnpmConfig: opts.pnpmConfig,
        }));
    }
    return outputs;
}
exports.default = default_1;
//# sourceMappingURL=index.js.map